<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SonicGradient</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>SonicGradient</h1>
    <select id="song-select"></select>
    <button id="play-button">Play</button>
    <div>
        <input type="number" id="target-hr" placeholder="Target Heart Rate">
        <select id="optimize-direction">
            <option value="minimize">Minimize</option>
            <option value="maximize">Maximize</option>
        </select>
        <button id="set-target">Set Target</button>
    </div>
    <div id="heart-rate-graph"></div>

    <script>
        $(document).ready(function() {
            $.get('/get_liked_songs', function(data) {
                data.forEach(function(song) {
                    $('#song-select').append($('<option>', {
                        value: song.id,
                        text: song.name
                    }));
                });
            });

            $('#play-button').click(function() {
                var songId = $('#song-select').val();
                $.post('/play_song', {song_id: songId}, function(data) {
                    if (data.status === 'success') {
                        updateHeartRateGraph(songId);
                    }
                });
            });

            $('#set-target').click(function() {
                var targetHr = $('#target-hr').val();
                var direction = $('#optimize-direction').val();
                $.post('/set_target_hr', {
                    target_hr: targetHr,
                    optimize_direction: direction
                }, function(data) {
                    if (data.status === 'success') {
                        alert('Target heart rate set!');
                    }
                });
            });

            function updateHeartRateGraph(songId) {
                $.get('/get_heart_rate_data', {song_id: songId}, function(data) {
                    var trace = {
                        x: data.map(d => d.timestamp),
                        y: data.map(d => d.heart_rate),
                        mode: 'lines+markers',
                        type: 'scatter'
                    };
                    var layout = {
                        title: 'Heart Rate During Song Playback',
                        xaxis: {title: 'Time'},
                        yaxis: {title: 'Heart Rate (BPM)'}
                    };
                    Plotly.newPlot('heart-rate-graph', [trace], layout);
                });
            }
        });
    </script>
</body>
</html>
